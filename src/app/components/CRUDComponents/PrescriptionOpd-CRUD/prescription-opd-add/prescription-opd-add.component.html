<form #VerifyPatientForm="ngForm" *ngIf="!this.IsPatientVerified">
    <div class="form-group">
        <label for="patientID">Patient ID</label>
        <input type="text" class="form-control" id="patientID" [(ngModel)]="patient.id"
            name="patientID" (keydown.enter)="loadPatient()" required>
    </div>
</form>
<div class="prescription" *ngIf="this.IsPatientVerified">
    <div  class="accordion accordion-flush my-5" id="accordionFlushExample">
        <div class="accordion-item my-5">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#patientSection" aria-expanded="false" aria-controls="patientSection">
                    Patient Details
                </button>
            </h2>
            <div id="patientSection" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                <div class="accordion-body">
                    <form #patientForm="ngForm">
                        <div class="form-group">
                            <label for="patientID">Patient ID</label>
                            <input type="text" class="form-control" id="patientID" [(ngModel)]="patient.patientID"
                                name="patientID" required>
                        </div>
                        <div class="form-group">
                            <label for="age">Age</label>
                            <ng-container *ngIf="calculateAge(patient.dob) as ageParts">
                                <span [ngStyle]="{ color: ageParts[0] ? 'blue' : 'gray' }">{{ ageParts[0] || 'N/A' }}</span><br>
                                <span [ngStyle]="{ color: ageParts[1] ? 'green' : 'gray' }">{{ ageParts[1] || 'N/A' }}</span><br>
                                <span [ngStyle]="{ color: ageParts[2] ? 'red' : 'gray' }">{{ ageParts[2] || 'N/A' }}</span><br>
                            </ng-container>
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <input type="text" class="form-control" id="gender" [(ngModel)]="patient.gender" name="gender"
                                required>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    
        <div class="accordion-item my-5">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#mainSection" aria-expanded="false" aria-controls="mainSection">
                    Main Details
                </button>
            </h2>
            <div id="mainSection" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                <div class="accordion-body">
                    <form #mainForm="ngForm">
                        <div class="form-group">
                            <label for="noOfDates">Number of Dates</label>
                            <input type="number" class="form-control" id="noOfDates" [(ngModel)]="newPrescription.noOfDates"
                                name="noOfDates" required>
                        </div>
                        <div class="form-group">
                            <label for="refills">Refills</label>
                            <input type="number" class="form-control" id="refills" [(ngModel)]="newPrescription.refills"
                                name="refills" required>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    
        <div class="accordion-item my-5">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#medicationsSection" aria-expanded="false" aria-controls="medicationsSection">
                    Add Medications
                </button>
            </h2>
            <div id="medicationsSection" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                <h3>Add Medications</h3>
                <div class="card card-body">
                    <div class="form-group">
                        <label for="medicationName">Medication Name</label>
                        <input type="text" class="form-control" id="medicationName" [(ngModel)]="medication.medicationName"
                            name="medicationName" required #medicationNameInput (keydown.enter)="focusNext(dosageInput)">
                    </div>
                    <div class="form-group">
                        <label for="dosage">Dosage</label>
                        <input type="text" class="form-control" id="dosage" [(ngModel)]="medication.dosage" name="dosage"
                            required #dosageInput (keydown.enter)="focusNext(frequencyInput)">
                    </div>
                    <div class="form-group">
                        <label for="frequency">Frequency</label>
                        <input type="text" class="form-control" id="frequency" [(ngModel)]="medication.frequency"
                            name="frequency" required #frequencyInput
                            (keydown.enter)="medicationFormSubmit(); focusNext(medicationNameInput);">
                    </div>
    
                    <table class="table" *ngIf="this.newMedications.length > 0">
                        <thead>
                            <tr>
                                <th>Medication Name</th>
                                <th>Dosage</th>
                                <th>Frequency</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let medication of newMedications" (click)="loadMedicationToForm(medication)">
                                <td>{{ medication.medicationName }}</td>
                                <td>{{ medication.dosage }}</td>
                                <td>{{ medication.frequency }}</td>
                                <td><button (click)="removeMedication(medication)" class="btn btn-danger">Remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-warning" (click)="clearMedications()" *ngIf="this.newMedications.length > 0">Clear All Medication</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="form-group">
            <label for="note">Note</label>
            <textarea class="form-control" id="note" [(ngModel)]="newPrescription.note"
                name="note"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" (click)="addPrescription()">Save</button>
    </div>
</div>
